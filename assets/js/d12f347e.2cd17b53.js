"use strict";(self.webpackChunkxcpdoc=self.webpackChunkxcpdoc||[]).push([[207],{8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(6540);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}},8991:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"advanced/specifications/transactions-format","title":"CBOR Format Migration Guide","description":"Introduction","source":"@site/docs/advanced/specifications/transactions-format.md","sourceDirName":"advanced/specifications","slug":"/advanced/specifications/transactions-format","permalink":"/docs/advanced/specifications/transactions-format","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/edit/master/website/docs/advanced/specifications/transactions-format.md","tags":[],"version":"current","frontMatter":{},"sidebar":"advanced","previous":{"title":"Taproot Envelope","permalink":"/docs/advanced/specifications/taproot-envelope"},"next":{"title":"Bug Bounties","permalink":"/docs/advanced/bounties"}}');var s=t(4848),i=t(8453);const r={},o="CBOR Format Migration Guide",c={},d=[{value:"Introduction",id:"introduction",level:2},{value:"General Format",id:"general-format",level:2},{value:"Transactions Using CBOR",id:"transactions-using-cbor",level:2},{value:"Enhanced Send (ID: 2)",id:"enhanced-send-id-2",level:3},{value:"Sweep (ID: 4)",id:"sweep-id-4",level:3},{value:"Issuance Standard (ID: 20)",id:"issuance-standard-id-20",level:3},{value:"Issuance Subasset (ID: 21)",id:"issuance-subasset-id-21",level:3},{value:"Fairminter (ID: 90)",id:"fairminter-id-90",level:3},{value:"Fairmint (ID: 91)",id:"fairmint-id-91",level:3},{value:"Broadcast (ID: 30)",id:"broadcast-id-30",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"cbor-format-migration-guide",children:"CBOR Format Migration Guide"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"Until v11, each transaction used a custom binary format, sometimes multiple formats, which was difficult to maintain and non-standard. Starting from v11, all transactions will be progressively updated to use the CBOR format."}),"\n",(0,s.jsx)(n.p,{children:"At the time when the original contracts were written, CBOR had just been created and there was no mature solution yet. Additionally, it was important to save every byte to try to fit within an OP_RETURN."}),"\n",(0,s.jsx)(n.p,{children:"Today, CBOR has become a mature and sustainable standard, and with the new encoding methods in witnesses, it is no longer as crucial to save every byte. CBOR is therefore perfectly suitable and this migration is part of the major cleanup and modernization effort of the Counterparty codebase that began last year."}),"\n",(0,s.jsx)(n.h2,{id:"general-format",children:"General Format"}),"\n",(0,s.jsx)(n.p,{children:"The new format follows this structure:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"1 byte"})," for the transaction ID (using ",(0,s.jsx)(n.code,{children:"config.SHORT_TXTYPE_FORMAT"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CBOR serialization"})," of a list of values of arbitrary types"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Addresses are compressed with the following function: ",(0,s.jsx)(n.a,{href:"https://github.com/CounterpartyXCP/counterparty-core/blob/master/counterparty-rs/src/utils.rs#L348-L377",children:"https://github.com/CounterpartyXCP/counterparty-core/blob/master/counterparty-rs/src/utils.rs#L348-L377"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Asset descriptions and broadcast texts are converted to bytes with the following function: ",(0,s.jsx)(n.a,{href:"https://github.com/CounterpartyXCP/counterparty-core/blob/master/counterparty-core/counterpartycore/lib/utils/helpers.py#L200-L204",children:"https://github.com/CounterpartyXCP/counterparty-core/blob/master/counterparty-core/counterpartycore/lib/utils/helpers.py#L200-L204"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"transactions-using-cbor",children:"Transactions Using CBOR"}),"\n",(0,s.jsx)(n.h3,{id:"enhanced-send-id-2",children:"Enhanced Send (ID: 2)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata += cbor2.dumps([\n    asset_id,\n    quantity,\n    short_address_bytes,\n    memo_bytes,\n])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"sweep-id-4",children:"Sweep (ID: 4)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata += cbor2.dumps([\n    short_address_bytes,\n    flags,\n    memo_bytes,\n])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issuance-standard-id-20",children:"Issuance Standard (ID: 20)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata_array = [\n    asset_id,\n    quantity,\n    divisible,\n    lock,\n    reset,\n    mime_type,\n]\nif validated_description is not None:\n    data_array.append(\n        helpers.content_to_bytes(validated_description, mime_type or "text/plain")\n    )\nelse:\n    data_array.append(None)\ndata += cbor2.dumps(data_array)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"issuance-subasset-id-21",children:"Issuance Subasset (ID: 21)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata_array = [\n    asset_id,\n    quantity,\n    1 if divisible else 0,\n    1 if lock else 0,\n    1 if reset else 0,\n    compacted_subasset_length,\n    compacted_subasset_longname,\n    mime_type,\n]\nif validated_description is not None:\n    data_array.append(\n        helpers.content_to_bytes(validated_description, mime_type or "text/plain")\n    )\nelse:\n    data_array.append(None)\ndata += cbor2.dumps(data_array)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"fairminter-id-90",children:"Fairminter (ID: 90)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata += cbor2.dumps([\n    asset_id,\n    asset_parent_id,\n    price,\n    quantity_by_price,\n    max_mint_per_tx,\n    max_mint_per_address,\n    hard_cap,\n    premint_quantity,\n    start_block,\n    end_block,\n    soft_cap,\n    soft_cap_deadline_block,\n    minted_asset_commission_int,\n    burn_payment,\n    lock_description,\n    lock_quantity,\n    divisible,\n    mime_type,\n    helpers.content_to_bytes(description, mime_type or "text/plain"),\n])\n'})}),"\n",(0,s.jsx)(n.h3,{id:"fairmint-id-91",children:"Fairmint (ID: 91)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata += cbor2.dumps([asset_id, quantity])\n"})}),"\n",(0,s.jsx)(n.h3,{id:"broadcast-id-30",children:"Broadcast (ID: 30)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'data = struct.pack(config.SHORT_TXTYPE_FORMAT, ID)\ndata += cbor2.dumps([\n    timestamp,\n    value,\n    fee_fraction_int,\n    mime_type,\n    helpers.content_to_bytes(text, mime_type or "text/plain"),\n])\n'})})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}}}]);