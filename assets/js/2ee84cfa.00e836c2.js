"use strict";(self.webpackChunkxcpdoc=self.webpackChunkxcpdoc||[]).push([[787],{7565:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"advanced/exchange-integration","title":"Exchange Integration","description":"Handling Deposits using Separate Addresses","source":"@site/docs/advanced/exchange-integration.md","sourceDirName":"advanced","slug":"/advanced/exchange-integration","permalink":"/docs/advanced/exchange-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/edit/master/website/docs/advanced/exchange-integration.md","tags":[],"version":"current","frontMatter":{"title":"Exchange Integration"},"sidebar":"advanced","previous":{"title":"Bug Bounties","permalink":"/docs/advanced/bounties"}}');var d=s(4848),t=s(8453);const r={title:"Exchange Integration"},a=void 0,c={},o=[{value:"Handling Deposits using Separate Addresses",id:"handling-deposits-using-separate-addresses",level:2},{value:"Handling Deposits using Memo Transactions",id:"handling-deposits-using-memo-transactions",level:2},{value:"Handling Withdrawals (Single Send)",id:"handling-withdrawals-single-send",level:2},{value:"Batching Withdrawals (Multi-Peer-Multi-Asset Send)",id:"batching-withdrawals-multi-peer-multi-asset-send",level:2},{value:"Best practices",id:"best-practices",level:2}];function l(e){const n={code:"code",h2:"h2",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.h2,{id:"handling-deposits-using-separate-addresses",children:"Handling Deposits using Separate Addresses"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Create a XCP holding address (or several primary XCP holding addresses). The address will hold deposited XCP funds for all users using the exchange."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Create a regular Bitcoin address for each user wanting to deposit XCP using the API of the Bitcoin Core instance that ",(0,d.jsx)(n.code,{children:"counterparty-server"})," is connecting to."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Poll for deposits using ",(0,d.jsx)(n.code,{children:"get_sends"}),", filtering for ",(0,d.jsx)(n.code,{children:"asset==XCP"}),", ",(0,d.jsx)(n.code,{children:"destination==deposit_address"})," and ",(0,d.jsx)(n.code,{children:"block_index<=current_block_index-number_of_desired_confirmations"}),". Record the quantity of the send transaction and the transaction's ",(0,d.jsx)(n.code,{children:"txid"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"'Prime' the deposit address by sending it 0.0005 BTC."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["For deposit, send the quantity deposited to the holding address using the ",(0,d.jsx)(n.code,{children:"do_send"})," with the flag ",(0,d.jsx)(n.code,{children:"unconfirmed=True"})," (so you don't have to wait for the priming to confirm). Record the ",(0,d.jsx)(n.code,{children:"txid"})," of this transaction."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["When the second send is confirmed (poll ",(0,d.jsx)(n.code,{children:"get_sends"})," again), credit the user\u2019s account balance."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"handling-deposits-using-memo-transactions",children:"Handling Deposits using Memo Transactions"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Create a XCP deposit address. The address will hold deposited XCP funds for all users using the exchange."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"'Prime' the deposit address by sending it small amount of BTC."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Make the deposit address require a memo by broadcasting ",(0,d.jsx)(n.code,{children:"OPTIONS 1"})," from that address.  The value and fee_fraction can be 0."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"When a user wishes to deposit to your exchange, generate a unique hexadecimal invoice ID for the deposit and convey that to the user.  The user must send counterparty assets into the address along with the matching invoice ID in the memo field.  If the user fails to include a memo, the send will be rejected by the network and the user's address will retain the assets they sent."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Poll for deposits using ",(0,d.jsx)(n.code,{children:"get_sends"}),", filtering for ",(0,d.jsx)(n.code,{children:"asset==XCP"}),", ",(0,d.jsx)(n.code,{children:"destination==deposit_address"})," and ",(0,d.jsx)(n.code,{children:"block_index<={current_block_index-number_of_desired_confirmations}"})," and ",(0,d.jsx)(n.code,{children:"memo_hex=={invoice_id}"}),". Record the quantity of the send transaction and the transaction's ",(0,d.jsx)(n.code,{children:"txid"}),"."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["When the send is confirmed with 2 confirmations (poll ",(0,d.jsx)(n.code,{children:"get_sends"})," again), credit the user\u2019s account balance."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Memo transactions are available as of block 489956"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"handling-withdrawals-single-send",children:"Handling Withdrawals (Single Send)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Prime the holding address if its current balance is below 0.0005 BTC."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Send the funds to the user-provided address with ",(0,d.jsx)(n.code,{children:"create_send"})," (Counterparty API)."]}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"batching-withdrawals-multi-peer-multi-asset-send",children:"Batching Withdrawals (Multi-Peer-Multi-Asset Send)"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Prime the holding address if its current balance is below 0.0005 BTC."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Generate first MPMA transaction by making a ",(0,d.jsx)(n.code,{children:"create_send"})," (Counterparty API) call and specify as many assets and recipient addresses as you would like."]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Sign and Broadcast first MPMA transaction and note ",(0,d.jsx)(n.code,{children:"txid"})]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["Generate second MPMA transaction by making identical ",(0,d.jsx)(n.code,{children:"create_send"})," (Counterparty API) call as before, except also specify ",(0,d.jsx)(n.code,{children:"p2sh_pretx_txid"})," param and give ",(0,d.jsx)(n.code,{children:"txid"})," of first MPMA transaction"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Sign and Broadcast second MPMA transaction"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h2,{id:"best-practices",children:"Best practices"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"For deposits, wait for at least two confirmations on the send to the desposit address and one confirmation for the send to the holding address."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Keep the private key for the holding address secret and safe."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Keep the bulk of your exchange's funds in cold storage."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Set a maximum XCP and BTC withdrawal amount, both per day and per event."}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Use a segwit address for memo deposits and MPMA/Batched withdrawals to keep transaction costs minimal."}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var i=s(6540);const d={},t=i.createContext(d);function r(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);